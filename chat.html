<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        #messages {
            width: 80%;
            max-width: 600px;
            height: 60vh;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
        }
        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
        }
        .message img.profile-img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
        #inputContainer {
            display: flex;
            align-items: center;
            width: 80%;
            max-width: 600px;
            position: relative;
        }
        #messageInput {
            flex: 1;
            padding: 10px;
            border-radius: 20px;
            border: none;
            margin-right: 10px;
        }
        #sendButton {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            background: #6a11cb;
            color: white;
            cursor: pointer;
        }
        #sendButton:hover {
            background: #2575fc;
        }
        .icon {
            margin-right: 10px;
            cursor: pointer;
            font-size: 24px;
        }
        #settingsMenu, #colorMenu, #profileModal {
            display: none;
            position: absolute;
            bottom: 50px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            color: black;
        }
        #settingsMenu {
            left: 0;
        }
        #colorMenu {
            right: 0;
        }
        #profileModal {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            text-align: center;
        }
        #settingsMenu label, #colorMenu label {
            display: block;
            margin-bottom: 10px;
        }
        #settingsMenu input[type="text"],
        #settingsMenu input[type="file"],
        #settingsMenu textarea,
        #colorMenu input[type="color"] {
            display: block;
            margin-bottom: 10px;
        }
        #settingsMenu button, #colorMenu button, #closeProfileModal {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            background: #6a11cb;
            color: white;
            cursor: pointer;
        }
        #settingsMenu button:hover, #colorMenu button:hover, #closeProfileModal:hover {
            background: #2575fc;
        }
        #profileModal img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="messages"></div>
    <div id="inputContainer">
        <span class="icon" id="settingsIcon">‚öôÔ∏è</span>
        <span class="icon" id="brushIcon">üñåÔ∏è</span>
        <input id="messageInput" type="text" placeholder="Escribe un mensaje...">
        <button id="sendButton">Enviar</button>
    </div>

    <div id="settingsMenu">
        <label for="usernameInput">Nombre de usuario</label>
        <input type="text" id="usernameInput" placeholder="Nombre de usuario">
        <label for="profileImageInput">Imagen de perfil</label>
        <input type="file" id="profileImageInput" accept="image/*">
        <label for="descriptionInput">Descripci√≥n</label>
        <textarea id="descriptionInput" placeholder="Escribe una descripci√≥n sobre ti"></textarea>
        <button id="saveSettingsButton">Guardar</button>
    </div>

    <div id="colorMenu">
        <label for="colorPicker">Elige un color para tu nombre</label>
        <input type="color" id="colorPicker">
        <button id="closeColorMenu">Cerrar</button>
    </div>

    <div id="profileModal">
        <img id="profileImage" src="" alt="Imagen de perfil">
        <h2 id="profileName"></h2>
        <p id="profileDescription"></p>
        <button id="closeProfileModal">Cerrar</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let username = ''; // Nombre de usuario por defecto vac√≠o
        let usernameColor = '#000000'; // Color por defecto
        let profileImage = ''; // Imagen de perfil por defecto
        let description = ''; // Descripci√≥n por defecto

        document.getElementById('sendButton').addEventListener('click', () => {
            if (!username || !profileImage) {
                alert('Por favor, selecciona un nombre de usuario y una imagen de perfil antes de enviar mensajes.');
                return;
            }

            const message = document.getElementById('messageInput').value;

            socket.emit('chatMessage', { text: message, username, profileImage, color: usernameColor, description });
            document.getElementById('messageInput').value = '';
        });

        socket.on('chatMessage', (msg) => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            if (msg.profileImage) {
                const imgElement = document.createElement('img');
                imgElement.src = msg.profileImage;
                imgElement.classList.add('profile-img');
                messageElement.appendChild(imgElement);
            }
            const textElement = document.createElement('div');
            textElement.innerHTML = `<span style="color: ${msg.color};" class="username" data-username="${msg.username}" data-profile="${msg.profileImage}" data-description="${msg.description}">${msg.username}:</span> ${msg.text}`;
            messageElement.appendChild(textElement);
            document.getElementById('messages').appendChild(messageElement);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        });

        document.getElementById('settingsIcon').addEventListener('click', () => {
            const settingsMenu = document.getElementById('settingsMenu');
            settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });

        document.getElementById('brushIcon').addEventListener('click', () => {
            const colorMenu = document.getElementById('colorMenu');
            colorMenu.style.display = colorMenu.style.display === 'block' ? 'none' : 'block';
        });

        document.getElementById('saveSettingsButton').addEventListener('click', () => {
            const newUsername = document.getElementById('usernameInput').value;
            if (newUsername) {
                username = newUsername;
            }

            const profileImageInput = document.getElementById('profileImageInput');
            if (profileImageInput.files && profileImageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    profileImage = e.target.result;
                };
                reader.readAsDataURL(profileImageInput.files[0]);
            }

            description = document.getElementById('descriptionInput').value;

            document.getElementById('settingsMenu').style.display = 'none';
        });

        document.getElementById('colorPicker').addEventListener('input', (event) => {
            usernameColor = event.target.value;
        });

        document.getElementById('closeColorMenu').addEventListener('click', () => {
            document.getElementById('colorMenu').style.display = 'none';
        });

        document.getElementById('messages').addEventListener('click', (event) => {
            if (event.target.classList.contains('username')) {
                const profileName = event.target.getAttribute('data-username');
                const profileImageSrc = event.target.getAttribute('data-profile');
                const profileDescription = event.target.getAttribute('data-description');
                document.getElementById('profileName').textContent = profileName;
                document.getElementById('profileImage').src = profileImageSrc;
                document.getElementById('profileDescription').textContent = profileDescription || 'Sin descripci√≥n';
                document.getElementById('profileModal').style.display = 'block';
            }
        });

        document.getElementById('closeProfileModal').addEventListener('click', () => {
            document.getElementById('profileModal').style.display = 'none';
        });
    </script>
</body>
</html>